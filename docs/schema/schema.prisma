// This schema is auto-generated based on the Room entities in the project.
// It reflects the data model used in the application's local database.

datasource db {
  provider = "sqlite" // Room uses SQLite
  url      = "file:./app_database.db"
}

generator client {
  provider = "prisma-client-js" // Placeholder; not actually used in Android
}

model Issuer {
  id   String @id @default(cuid()) // NoSQL-style Object ID
  name String

  cards Card[]

  @@map("issuers")
}

model Card {
  id          String      @id @default(cuid()) // NoSQL-style Object ID
  issuerId    String      @map("issuer_id")
  productName String      @map("product_name")
  cardFace    CardFace[]
  network     CardNetwork @default(Visa)
  annualFee   Float       @map("annual_fee")
  profileCards ProfileCard[]

  issuer Issuer @relation(fields: [issuerId], references: [id], onDelete: Cascade)

  @@index([issuerId])
  @@map("cards")
}

model CardFace {
  id  String @id @default(cuid()) // NoSQL-style Object ID
  url String

  card   Card?   @relation(fields: [cardId], references: [id])
  cardId String?
}

model ProfileCard {
  id                   String               @id @default(cuid()) // NoSQL-style Object ID
  profileId            String               @map("profile_id")
  templateCardId       String?              @map("template_card_id")
  nickname             String?
  annualFee            Float                @map("annual_fee")
  lastFour             String?              @map("last_four")
  openDateUtc          String?              @map("open_date_utc")
  closeDateUtc         String?              @map("close_date_utc")
  statementCutUtc      String?              @map("statement_cut_utc")
  welcomeOfferProgress String?              @map("welcome_offer_progress")
  status               CardStaus            @default(Active)
  notes                String?
  subSpending          Float?               @map("sub_spending")
  subDuration          Int?                 @map("sub_duration")
  subDurationUnit      CardSubDurationUnit? @map("sub_duration_unit")
  
  benefits     Benefit[]
  offers       Offer[]
  applications Application[]

  profile  Profile @relation(fields: [profileId], references: [id], onDelete: Cascade)
  template Card?   @relation(fields: [templateCardId], references: [id])

  @@index([profileId])
  @@index([templateCardId])
  @@map("profile_cards")
}

model Benefit {
  id                 String            @id @default(cuid()) @map("_id")
  profileCardId      String            @map("profile_card_id")
  type               BenefitType       @default(Credit)
  amount             Float?            @map("amount")
  cap                Float?            @map("cap")
  frequency          BenefitFrequency
  category           BenefitCategory[]
  merchant           String?
  enrollmentRequired Boolean           @map("enrollment_required")
  startDateUtc       String            @map("start_date_utc")
  endDateUtc         String?           @map("end_date_utc")
  notes              String?
  transactions       Transaction[]

  // Relations
  profileCard       ProfileCard        @relation(fields: [profileCardId], references: [id], onDelete: Cascade)
  notificationRules NotificationRule[]

  @@index([profileCardId])
  @@map("benefits")
}

model Transaction {
  id        String  @id @default(cuid()) @map("_id")
  benefitId String? @map("benefit_id")
  notes     String?
  dateUtc   String?
  amount    Float

  benefit Benefit? @relation(fields: [benefitId], references: [id])

  @@index([benefitId])
  @@map("transactions")
}

model Offer {
  id             String  @id @default(cuid())
  profileCardId  String  @map("profile_card_id")
  title          String
  note           String?
  startDateUtc   String? @map("start_date_utc")
  endDateUtc     String? @map("end_date_utc")
  type           String
  multiplierRate Float?  @map("multiplier_rate")
  minSpend       Float?  @map("min_spend")
  maxCashBack    Float?  @map("max_cash_back")
  status         String  @default("active")

  // Relations
  profileCard ProfileCard @relation(fields: [profileCardId], references: [id], onDelete: Cascade)

  @@index([profileCardId])
  @@map("offers")
}

model Application {
  id                   String  @id @default(cuid())
  profileCardId        String  @map("profile_card_id")
  applicationDateUtc   String? @map("application_date_utc")
  decisionDateUtc      String? @map("decision_date_utc")
  status               String
  creditBureau         String? @map("credit_bureau")
  reconsiderationNotes String? @map("reconsideration_notes")
  welcomeOfferTerms    String? @map("welcome_offer_terms")

  // Relations
  profileCard ProfileCard @relation(fields: [profileCardId], references: [id], onDelete: Cascade)

  @@index([profileCardId])
  @@map("applications")
}

model NotificationRule {
  id        String  @id @default(cuid())
  benefitId String  @map("benefit_id")
  trigger   String
  channel   String
  enabled   Boolean

  // Relations
  benefit Benefit @relation(fields: [benefitId], references: [id], onDelete: Cascade)

  @@index([benefitId])
  @@map("notification_rules")
}

enum CardNetwork {
  Visa
  Mastercard
  Discover
  Amex
}

enum CardStaus {
  Active
  Closed
  Pending
}

enum CardSubDurationUnit {
  Day
  Month
}

model Profile {
  id      String       @id @default(cuid())
  userId  String?
  name    String
  cards   ProfileCard[]

  @@map("profiles")
}

enum BenefitCategory {
  Dining
  OnlineShopping
  Grocery
  Restaurant
  DrugStore
  Travel
  Gas
  EVCharging
  Streaming
  Transit
  Utilities
}

enum BenefitFrequency {
  Monthly
  Quarterly
  SemiAnnually
  Annually
}

enum BenefitType {
  Credit
  Multiplier
}
